{"version":3,"sources":["ReactNativeZoomableView.tsx"],"names":["debounce","React","Component","createRef","Animated","Easing","PanResponder","StyleSheet","View","getBoundaryCrossedAnim","getPanMomentumDecayAnim","getZoomToAnimation","AnimatedTouchFeedback","StaticPin","DebugTouchPoint","calcGestureCenterPoint","calcGestureTouchDistance","calcNewScaledOffsetForZoomCentering","applyPanBoundariesToOffset","viewportPositionToImagePosition","initialState","originalWidth","originalHeight","originalPageX","originalPageY","originalX","originalY","pinSize","width","height","ReactNativeZoomableView","gestureStarted","v","_gestureStarted","constructor","props","ValueXY","x","y","Value","value","boundaryCrossedAnimInEffect","position","onStaticPinPositionChange","requestAnimationFrame","setTimeout","zoomSubjectWrapperRef","current","measure","pageX","pageY","state","setState","e","gestureState","onStartShouldSetPanResponder","_getZoomableViewEventObject","onLongPress","persist","longPressTimeout","longPressDuration","onPanResponderGrant","panAnim","stopAnimation","zoomAnim","raisePin","gestureType","_resolveAndHandleTap","debugPoints","lastGestureCenterPosition","disableMomentum","panEnabled","disablePanOnInitialZoom","zoomLevel","initialZoom","vx","vy","start","clearTimeout","onPanResponderEnd","onZoomEnd","onShiftingEnd","staticPinPosition","_updateStaticPin","dropPin","onPanResponderMove","numberActiveTouches","_handlePanResponderGrant","_handlePanResponderEnd","lastGestureTouchDistance","_handlePinching","Math","abs","dx","dy","isShiftGesture","_handleShifting","now","Date","doubleTapFirstTapReleaseTimestamp","doubleTapDelay","doubleTapFirstTap","_addTouch","id","toString","isSecondTap","singleTapTimeoutId","_handleDoubleTap","nativeEvent","tapX","tapY","timing","toValue","offsetX","offsetY","useNativeDriver","duration","onSingleTap","contentWidth","contentHeight","pinX","pinY","setValue","viewportPosition","imageSize","zoomableEvent","_staticPinPosition","gestureHandlers","create","_handleStartShouldSetPanResponder","_handlePanResponderMove","onPanResponderRelease","onPanResponderTerminate","evt","onPanResponderTerminationRequest","onShouldBlockNativeResponder","onStartShouldSetPanResponderCapture","onMoveShouldSetPanResponderCapture","zoomAnimatedValue","panAnimatedValueXY","initialOffsetX","initialOffsetY","addListener","animatePin","pinAnim","easing","out","ease","__setOffset","__getOffset","axis","offset","offsetState","__offsets","bindToBorders","containerSize","contentSize","boundOffset","panBoundaryPadding","boundariesApplied","toFixed","componentDidUpdate","prevProps","prevState","zoomEnabled","onTransformInvocationInitialized","_invokeOnTransform","successful","currState","originalMeasurementsChanged","staticPinPositionChanged","layout","onLayout","componentDidMount","measureZoomSubject","measureZoomSubjectInterval","setInterval","componentWillUnmount","clearInterval","zoomableViewEvent","onTransform","onStaticPinPositionMove","debouncedOnStaticPinPositionChange","overwriteObj","maxZoom","minZoom","pinchToZoomInSensitivity","pinchToZoomOutSensitivity","distance","onZoomBefore","zoomGrowthFromLastGestureState","pinchToZoomSensitivity","deltaGrowth","deltaGrowthAdjustedBySensitivity","newZoomLevel","gestureCenterPoint","zoomCenter","debug","_setPinchDebugPoints","oldOffsetX","oldOffsetY","oldScale","newScale","offsetShift","_calcOffsetShiftSinceLastGestureState","onZoomAfter","gestureResponderEvent","points","touches","movementSensibility","shift","shiftX","shiftY","moveX","moveY","_setNewOffsetPosition","newOffsetX","newOffsetY","onShiftingBefore","onShiftingAfter","touch","push","_removeTouch","splice","indexOf","onDoubleTapBefore","onDoubleTapAfter","doubleTapZoomToCenter","nextZoomStep","_getNextZoomStep","zoomPositionCoordinates","zoomTo","zoomStep","listenerId","prevScale","removeListener","zoomBy","zoomLevelChange","moveTo","moveBy","offsetChangeX","offsetChangeY","render","staticPinIcon","children","visualTouchFeedbackEnabled","onStaticPinLongPress","onStaticPinPress","pinProps","styles","container","panHandlers","zoomSubject","style","transform","scale","getTranslateTransform","map","index","size","undefined","alignItems","flex","justifyContent","overflow"],"mappings":"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","sourcesContent":["import { debounce } from 'lodash';\nimport React, { Component, createRef, RefObject } from 'react';\nimport {\n  Animated,\n  Easing,\n  GestureResponderEvent,\n  PanResponder,\n  PanResponderCallbacks,\n  PanResponderGestureState,\n  PanResponderInstance,\n  StyleSheet,\n  View,\n} from 'react-native';\n\nimport {\n  getBoundaryCrossedAnim,\n  getPanMomentumDecayAnim,\n  getZoomToAnimation,\n} from './animations';\nimport { AnimatedTouchFeedback } from './components';\nimport { StaticPin } from './components/StaticPin';\nimport { DebugTouchPoint } from './debugHelper';\nimport {\n  calcGestureCenterPoint,\n  calcGestureTouchDistance,\n  calcNewScaledOffsetForZoomCentering,\n} from './helper';\nimport { applyPanBoundariesToOffset } from './helper/applyPanBoundariesToOffset';\nimport { viewportPositionToImagePosition } from './helper/coordinateConversion';\nimport {\n  ReactNativeZoomableViewProps,\n  ReactNativeZoomableViewState,\n  Size2D,\n  TouchPoint,\n  Vec2D,\n  ZoomableViewEvent,\n} from './typings';\n\nconst initialState: ReactNativeZoomableViewState = {\n  originalWidth: 0,\n  originalHeight: 0,\n  originalPageX: 0,\n  originalPageY: 0,\n  originalX: 0,\n  originalY: 0,\n  pinSize: { width: 0, height: 0 },\n};\n\nclass ReactNativeZoomableView extends Component<\n  ReactNativeZoomableViewProps,\n  ReactNativeZoomableViewState\n> {\n  zoomSubjectWrapperRef: RefObject<View>;\n  gestureHandlers: PanResponderInstance;\n  doubleTapFirstTapReleaseTimestamp: number | undefined;\n\n  static defaultProps = {\n    zoomEnabled: true,\n    panEnabled: true,\n    initialZoom: 1,\n    initialOffsetX: 0,\n    initialOffsetY: 0,\n    maxZoom: 1.5,\n    minZoom: 0.5,\n    pinchToZoomInSensitivity: 1,\n    pinchToZoomOutSensitivity: 1,\n    movementSensibility: 1,\n    doubleTapDelay: 300,\n    bindToBorders: true,\n    zoomStep: 0.5,\n    onLongPress: null,\n    longPressDuration: 700,\n    contentWidth: undefined,\n    contentHeight: undefined,\n    panBoundaryPadding: 0,\n    visualTouchFeedbackEnabled: true,\n    staticPinPosition: undefined,\n    staticPinIcon: undefined,\n    onStaticPinPositionChange: undefined,\n    onStaticPinPositionMove: undefined,\n    animatePin: true,\n    disablePanOnInitialZoom: false,\n  };\n\n  private panAnim = new Animated.ValueXY({ x: 0, y: 0 });\n  private zoomAnim = new Animated.Value(1);\n  private pinAnim = new Animated.ValueXY({ x: 0, y: 0 });\n\n  private __offsets = {\n    x: {\n      value: 0,\n      boundaryCrossedAnimInEffect: false,\n    },\n    y: {\n      value: 0,\n      boundaryCrossedAnimInEffect: false,\n    },\n  };\n\n  private zoomLevel = 1;\n  private lastGestureCenterPosition: { x: number; y: number } | null = null;\n  private lastGestureTouchDistance: number | null = null;\n  private gestureType: 'pinch' | 'shift' | null;\n\n  private _gestureStarted = false;\n  private set gestureStarted(v: boolean) {\n    this._gestureStarted = v;\n  }\n\n  public get gestureStarted() {\n    return this._gestureStarted;\n  }\n\n  /**\n   * Last press time (used to evaluate whether user double tapped)\n   * @type {number}\n   */\n  private longPressTimeout: NodeJS.Timeout | null = null;\n  private onTransformInvocationInitialized: boolean | undefined;\n  private singleTapTimeoutId: NodeJS.Timeout | undefined;\n  private touches: TouchPoint[] = [];\n  private doubleTapFirstTap: TouchPoint | undefined;\n  private measureZoomSubjectInterval: NodeJS.Timer | undefined;\n\n  constructor(props: ReactNativeZoomableViewProps) {\n    super(props);\n    // This needs to be done before anything else to initialize the state.\n    // Otherwise, the logic below may reference the state when it's undefined,\n    // causing runtime errors.\n    this.state = { ...initialState };\n\n    this.gestureHandlers = PanResponder.create({\n      onStartShouldSetPanResponder: this._handleStartShouldSetPanResponder,\n      onPanResponderGrant: this._handlePanResponderGrant,\n      onPanResponderMove: this._handlePanResponderMove,\n      onPanResponderRelease: this._handlePanResponderEnd,\n      onPanResponderTerminate: (evt, gestureState) => {\n        // We should also call _handlePanResponderEnd\n        // to properly perform cleanups when the gesture is terminated\n        // (aka gesture handling responsibility is taken over by another component).\n        // This also fixes a weird issue where\n        // on real device, sometimes onPanResponderRelease is not called when you lift 2 fingers up,\n        // but onPanResponderTerminate is called instead for no apparent reason.\n        this._handlePanResponderEnd(evt, gestureState);\n        this.props.onPanResponderTerminate?.(\n          evt,\n          gestureState,\n          this._getZoomableViewEventObject()\n        );\n      },\n      onPanResponderTerminationRequest: (evt, gestureState) =>\n        !!this.props.onPanResponderTerminationRequest?.(\n          evt,\n          gestureState,\n          this._getZoomableViewEventObject()\n        ),\n      // Defaults to true to prevent parent components, such as React Navigation's tab view, from taking over as responder.\n      onShouldBlockNativeResponder: (evt, gestureState) =>\n        this.props.onShouldBlockNativeResponder?.(\n          evt,\n          gestureState,\n          this._getZoomableViewEventObject()\n        ) ?? true,\n      onStartShouldSetPanResponderCapture: (evt, gestureState) =>\n        !!this.props.onStartShouldSetPanResponderCapture?.(evt, gestureState),\n      onMoveShouldSetPanResponderCapture: (evt, gestureState) =>\n        !!this.props.onMoveShouldSetPanResponderCapture?.(evt, gestureState),\n    });\n\n    this.zoomSubjectWrapperRef = createRef<View>();\n\n    if (this.props.zoomAnimatedValue)\n      this.zoomAnim = this.props.zoomAnimatedValue;\n    if (this.props.panAnimatedValueXY)\n      this.panAnim = this.props.panAnimatedValueXY;\n\n    if (this.props.initialZoom) this.zoomLevel = this.props.initialZoom;\n    if (this.props.initialOffsetX != null)\n      this.offsetX = this.props.initialOffsetX;\n    if (this.props.initialOffsetY != null)\n      this.offsetY = this.props.initialOffsetY;\n\n    this.panAnim.setValue({ x: this.offsetX, y: this.offsetY });\n    this.zoomAnim.setValue(this.zoomLevel);\n    this.panAnim.addListener(({ x, y }) => {\n      this.offsetX = x;\n      this.offsetY = y;\n    });\n    this.zoomAnim.addListener(({ value }) => {\n      this.zoomLevel = value;\n    });\n\n    this.lastGestureTouchDistance = 150;\n\n    this.gestureType = null;\n  }\n\n  private raisePin() {\n    if (!this.props.animatePin) return;\n    Animated.timing(this.pinAnim, {\n      toValue: { x: 0, y: -10 },\n      useNativeDriver: true,\n      easing: Easing.out(Easing.ease),\n      duration: 100,\n    }).start();\n  }\n\n  private dropPin() {\n    if (!this.props.animatePin) return;\n    Animated.timing(this.pinAnim, {\n      toValue: { x: 0, y: 0 },\n      useNativeDriver: true,\n      easing: Easing.out(Easing.ease),\n      duration: 100,\n    }).start();\n  }\n\n  private set offsetX(x: number) {\n    this.__setOffset('x', x);\n  }\n\n  private set offsetY(y: number) {\n    this.__setOffset('y', y);\n  }\n\n  private get offsetX() {\n    return this.__getOffset('x');\n  }\n\n  private get offsetY() {\n    return this.__getOffset('y');\n  }\n\n  private __setOffset(axis: 'x' | 'y', offset: number) {\n    const offsetState = this.__offsets[axis];\n\n    if (this.props.bindToBorders) {\n      const containerSize =\n        axis === 'x' ? this.state.originalWidth : this.state.originalHeight;\n      const contentSize =\n        axis === 'x'\n          ? this.props.contentWidth || this.state.originalWidth\n          : this.props.contentHeight || this.state.originalHeight;\n\n      const boundOffset =\n        contentSize && containerSize && this.props.panBoundaryPadding != null\n          ? applyPanBoundariesToOffset(\n              offset,\n              containerSize,\n              contentSize,\n              this.zoomLevel,\n              this.props.panBoundaryPadding\n            )\n          : offset;\n\n      if (!this.gestureType && !offsetState.boundaryCrossedAnimInEffect) {\n        const boundariesApplied =\n          boundOffset !== offset &&\n          boundOffset.toFixed(3) !== offset.toFixed(3);\n        if (boundariesApplied) {\n          offsetState.boundaryCrossedAnimInEffect = true;\n          getBoundaryCrossedAnim(this.panAnim[axis], boundOffset).start(() => {\n            offsetState.boundaryCrossedAnimInEffect = false;\n          });\n          return;\n        }\n      }\n    }\n\n    offsetState.value = offset;\n  }\n\n  private __getOffset(axis: 'x' | 'y') {\n    return this.__offsets[axis].value;\n  }\n\n  componentDidUpdate(\n    prevProps: ReactNativeZoomableViewProps,\n    prevState: ReactNativeZoomableViewState\n  ) {\n    const { zoomEnabled, initialZoom } = this.props;\n    if (prevProps.zoomEnabled && !zoomEnabled && initialZoom) {\n      this.zoomLevel = initialZoom;\n      this.zoomAnim.setValue(this.zoomLevel);\n    }\n    if (\n      !this.onTransformInvocationInitialized &&\n      this._invokeOnTransform().successful\n    ) {\n      this.panAnim.addListener(() => this._invokeOnTransform());\n      this.zoomAnim.addListener(() => this._invokeOnTransform());\n      this.onTransformInvocationInitialized = true;\n    }\n\n    const currState = this.state;\n    const originalMeasurementsChanged =\n      currState.originalHeight !== prevState.originalHeight ||\n      currState.originalWidth !== prevState.originalWidth ||\n      currState.originalPageX !== prevState.originalPageX ||\n      currState.originalPageY !== prevState.originalPageY ||\n      currState.originalX !== prevState.originalX ||\n      currState.originalY !== prevState.originalY;\n\n    const staticPinPositionChanged =\n      prevProps.staticPinPosition?.x !== this.props.staticPinPosition?.x ||\n      prevProps.staticPinPosition?.y !== this.props.staticPinPosition?.y;\n\n    // We use a custom `onLayout` event, so the clients can stay in-sync\n    // with when the internal measurements are actually saved to the state,\n    // thus helping them apply transformations at more accurate timings\n    if (originalMeasurementsChanged) {\n      const layout = {\n        width: currState.originalWidth,\n        height: currState.originalHeight,\n        x: currState.originalX,\n        y: currState.originalY,\n      };\n      this.props.onLayout?.({ nativeEvent: { layout } });\n    }\n\n    if (\n      this.onTransformInvocationInitialized &&\n      (originalMeasurementsChanged || staticPinPositionChanged)\n    ) {\n      this._invokeOnTransform();\n    }\n  }\n\n  componentDidMount() {\n    this.measureZoomSubject();\n    // We've already run `grabZoomSubjectOriginalMeasurements` at various events\n    // to make sure the measurements are promptly updated.\n    // However, there might be cases we haven't accounted for, especially when\n    // native processes are involved. To account for those cases,\n    // we'll use an interval here to ensure we're always up-to-date.\n    // The `setState` in `grabZoomSubjectOriginalMeasurements` won't trigger a rerender\n    // if the values given haven't changed, so we're not running performance risk here.\n    this.measureZoomSubjectInterval = setInterval(this.measureZoomSubject, 1e3);\n  }\n\n  componentWillUnmount() {\n    this.measureZoomSubjectInterval &&\n      clearInterval(this.measureZoomSubjectInterval);\n  }\n\n  debouncedOnStaticPinPositionChange = debounce(\n    (position: Vec2D) => this.props.onStaticPinPositionChange?.(position),\n    100\n  );\n\n  /**\n   * try to invoke onTransform\n   * @private\n   */\n  _invokeOnTransform() {\n    const zoomableViewEvent = this._getZoomableViewEventObject();\n    const position = this._staticPinPosition();\n\n    if (!zoomableViewEvent.originalWidth || !zoomableViewEvent.originalHeight)\n      return { successful: false };\n\n    this.props.onTransform?.(zoomableViewEvent);\n\n    if (position) {\n      this.props.onStaticPinPositionMove?.(position);\n      this.debouncedOnStaticPinPositionChange(position);\n    }\n\n    return { successful: true };\n  }\n\n  /**\n   * Returns additional information about components current state for external event hooks\n   *\n   * @returns {{}}\n   * @private\n   */\n  _getZoomableViewEventObject(overwriteObj = {}): ZoomableViewEvent {\n    return {\n      zoomLevel: this.zoomLevel,\n      offsetX: this.offsetX,\n      offsetY: this.offsetY,\n      originalHeight: this.state.originalHeight,\n      originalWidth: this.state.originalWidth,\n      originalPageX: this.state.originalPageX,\n      originalPageY: this.state.originalPageY,\n      ...overwriteObj,\n    } as ZoomableViewEvent;\n  }\n\n  /**\n   * Get the original box dimensions and save them for later use.\n   * (They will be used to calculate boxBorders)\n   *\n   * @private\n   */\n  private measureZoomSubject = () => {\n    // make sure we measure after animations are complete\n    requestAnimationFrame(() => {\n      // this setTimeout is here to fix a weird issue on iOS where the measurements are all `0`\n      // when navigating back (react-navigation stack) from another view\n      // while closing the keyboard at the same time\n      setTimeout(() => {\n        // In normal conditions, we're supposed to measure zoomSubject instead of its wrapper.\n        // However, our zoomSubject may have been transformed by an initial zoomLevel or offset,\n        // in which case these measurements will not represent the true \"original\" measurements.\n        // We just need to make sure the zoomSubjectWrapper perfectly aligns with the zoomSubject\n        // (no border, space, or anything between them)\n        this.zoomSubjectWrapperRef.current?.measure(\n          (x, y, width, height, pageX, pageY) => {\n            // When the component is off-screen, these become all 0s, so we don't set them\n            // to avoid messing up calculations, especially ones that are done right after\n            // the component transitions from hidden to visible.\n            if (!pageX && !pageY && !width && !height) return;\n\n            // If these values are all the same, don't re-set them in state\n            // this way we don't re-render\n            if (\n              this.state.originalX === x &&\n              this.state.originalY === y &&\n              this.state.originalWidth === width &&\n              this.state.originalHeight === height &&\n              this.state.originalPageX === pageX &&\n              this.state.originalPageY === pageY\n            ) {\n              return;\n            }\n\n            this.setState({\n              originalX: x,\n              originalY: y,\n              originalWidth: width,\n              originalHeight: height,\n              originalPageX: pageX,\n              originalPageY: pageY,\n            });\n          }\n        );\n      });\n    });\n  };\n\n  /**\n   * Handles the start of touch events and checks for taps\n   *\n   * @param e\n   * @param gestureState\n   * @returns {boolean}\n   *\n   * @private\n   */\n  _handleStartShouldSetPanResponder = (\n    e: GestureResponderEvent,\n    gestureState: PanResponderGestureState\n  ) => {\n    if (this.props.onStartShouldSetPanResponder) {\n      this.props.onStartShouldSetPanResponder(\n        e,\n        gestureState,\n        this._getZoomableViewEventObject(),\n        false\n      );\n    }\n\n    // Always set pan responder on start\n    // of gesture so we can handle tap.\n    // \"Pan threshold validation\" will be handled\n    // in `onPanResponderMove` instead of in `onMoveShouldSetPanResponder`\n    return true;\n  };\n\n  /**\n   * Calculates pinch distance\n   *\n   * @param e\n   * @param gestureState\n   * @private\n   */\n  _handlePanResponderGrant: NonNullable<\n    PanResponderCallbacks['onPanResponderGrant']\n  > = (e, gestureState) => {\n    if (this.props.onLongPress) {\n      e.persist();\n      this.longPressTimeout = setTimeout(() => {\n        this.props.onLongPress?.(\n          e,\n          gestureState,\n          this._getZoomableViewEventObject()\n        );\n        this.longPressTimeout = null;\n      }, this.props.longPressDuration);\n    }\n\n    this.props.onPanResponderGrant?.(\n      e,\n      gestureState,\n      this._getZoomableViewEventObject()\n    );\n\n    this.panAnim.stopAnimation();\n    this.zoomAnim.stopAnimation();\n    this.gestureStarted = true;\n\n    this.raisePin();\n  };\n\n  /**\n   * Handles the end of touch events\n   *\n   * @param e\n   * @param gestureState\n   *\n   * @private\n   */\n  _handlePanResponderEnd: NonNullable<\n    PanResponderCallbacks['onPanResponderEnd']\n  > = (e, gestureState) => {\n    if (!this.gestureType) {\n      this._resolveAndHandleTap(e);\n    }\n\n    this.setState({ debugPoints: [] });\n\n    this.lastGestureCenterPosition = null;\n\n    const disableMomentum =\n      this.props.disableMomentum ||\n      (this.props.panEnabled &&\n        this.gestureType === 'shift' &&\n        this.props.disablePanOnInitialZoom &&\n        this.zoomLevel === this.props.initialZoom);\n\n    // Trigger final shift animation unless disablePanOnInitialZoom is set and we're on the initial zoom level\n    // or disableMomentum\n    if (!disableMomentum) {\n      getPanMomentumDecayAnim(this.panAnim, {\n        x: gestureState.vx / this.zoomLevel,\n        y: gestureState.vy / this.zoomLevel,\n      }).start();\n    }\n\n    if (this.longPressTimeout) {\n      clearTimeout(this.longPressTimeout);\n      this.longPressTimeout = null;\n    }\n\n    this.props.onPanResponderEnd?.(\n      e,\n      gestureState,\n      this._getZoomableViewEventObject()\n    );\n\n    if (this.gestureType === 'pinch') {\n      this.props.onZoomEnd?.(\n        e,\n        gestureState,\n        this._getZoomableViewEventObject()\n      );\n    } else if (this.gestureType === 'shift') {\n      this.props.onShiftingEnd?.(\n        e,\n        gestureState,\n        this._getZoomableViewEventObject()\n      );\n    }\n\n    if (this.props.staticPinPosition) {\n      this._updateStaticPin();\n    }\n\n    this.dropPin();\n\n    this.gestureType = null;\n    this.gestureStarted = false;\n  };\n\n  /**\n   * Handles the actual movement of our pan responder\n   *\n   * @param e\n   * @param gestureState\n   *\n   * @private\n   */\n  _handlePanResponderMove = (\n    e: GestureResponderEvent,\n    gestureState: PanResponderGestureState\n  ) => {\n    if (this.props.onPanResponderMove) {\n      if (\n        this.props.onPanResponderMove(\n          e,\n          gestureState,\n          this._getZoomableViewEventObject()\n        )\n      ) {\n        return false;\n      }\n    }\n\n    // Only supports 2 touches and below,\n    // any invalid number will cause the gesture to end.\n    if (gestureState.numberActiveTouches <= 2) {\n      if (!this.gestureStarted) {\n        this._handlePanResponderGrant(e, gestureState);\n      }\n    } else {\n      if (this.gestureStarted) {\n        this._handlePanResponderEnd(e, gestureState);\n      }\n      return true;\n    }\n\n    if (gestureState.numberActiveTouches === 2) {\n      if (this.longPressTimeout) {\n        clearTimeout(this.longPressTimeout);\n        this.longPressTimeout = null;\n      }\n\n      // change some measurement states when switching gesture to ensure a smooth transition\n      if (this.gestureType !== 'pinch') {\n        this.lastGestureCenterPosition = calcGestureCenterPoint(\n          e,\n          gestureState\n        );\n        this.lastGestureTouchDistance = calcGestureTouchDistance(\n          e,\n          gestureState\n        );\n      }\n      this.gestureType = 'pinch';\n      this._handlePinching(e, gestureState);\n    } else if (gestureState.numberActiveTouches === 1) {\n      if (\n        this.longPressTimeout &&\n        (Math.abs(gestureState.dx) > 5 || Math.abs(gestureState.dy) > 5)\n      ) {\n        clearTimeout(this.longPressTimeout);\n        this.longPressTimeout = null;\n      }\n      // change some measurement states when switching gesture to ensure a smooth transition\n      if (this.gestureType !== 'shift') {\n        this.lastGestureCenterPosition = calcGestureCenterPoint(\n          e,\n          gestureState\n        );\n      }\n\n      const { dx, dy } = gestureState;\n      const isShiftGesture = Math.abs(dx) > 2 || Math.abs(dy) > 2;\n      if (isShiftGesture) {\n        this.gestureType = 'shift';\n        this._handleShifting(gestureState);\n      }\n    }\n  };\n\n  /**\n   * Handles the pinch movement and zooming\n   *\n   * @param e\n   * @param gestureState\n   *\n   * @private\n   */\n  _handlePinching(\n    e: GestureResponderEvent,\n    gestureState: PanResponderGestureState\n  ) {\n    if (!this.props.zoomEnabled) return;\n\n    const {\n      maxZoom,\n      minZoom,\n      pinchToZoomInSensitivity,\n      pinchToZoomOutSensitivity,\n    } = this.props;\n\n    const distance = calcGestureTouchDistance(e, gestureState);\n\n    if (\n      this.props.onZoomBefore &&\n      this.props.onZoomBefore(\n        e,\n        gestureState,\n        this._getZoomableViewEventObject()\n      )\n    ) {\n      return;\n    }\n\n    if (!distance) return;\n    if (!this.lastGestureTouchDistance) return;\n\n    // define the new zoom level and take zoom level sensitivity into consideration\n    const zoomGrowthFromLastGestureState =\n      distance / this.lastGestureTouchDistance;\n    this.lastGestureTouchDistance = distance;\n\n    const pinchToZoomSensitivity =\n      zoomGrowthFromLastGestureState < 1\n        ? pinchToZoomOutSensitivity\n        : pinchToZoomInSensitivity;\n\n    if (pinchToZoomSensitivity == null) return;\n    const deltaGrowth = zoomGrowthFromLastGestureState - 1;\n    // 0 - no resistance\n    // 10 - 90% resistance\n    const deltaGrowthAdjustedBySensitivity =\n      deltaGrowth * (1 - (pinchToZoomSensitivity * 9) / 100);\n\n    let newZoomLevel = this.zoomLevel * (1 + deltaGrowthAdjustedBySensitivity);\n\n    // make sure max and min zoom levels are respected\n    if (maxZoom != null && newZoomLevel > maxZoom) {\n      newZoomLevel = maxZoom;\n    }\n\n    if (minZoom != null && newZoomLevel < minZoom) {\n      newZoomLevel = minZoom;\n    }\n\n    const gestureCenterPoint = calcGestureCenterPoint(e, gestureState);\n\n    if (!gestureCenterPoint) return;\n\n    let zoomCenter = {\n      x: gestureCenterPoint.x - this.state.originalPageX,\n      y: gestureCenterPoint.y - this.state.originalPageY,\n    };\n\n    if (this.props.staticPinPosition) {\n      // When we use a static pin position, the zoom centre is the same as that position,\n      // otherwise the pin moves around way too much while zooming.\n      zoomCenter = {\n        x: this.props.staticPinPosition.x,\n        y: this.props.staticPinPosition.y,\n      };\n    }\n\n    // Uncomment to debug\n    this.props.debug && this._setPinchDebugPoints(e, zoomCenter);\n\n    const { originalHeight, originalWidth } = this.state;\n\n    const oldOffsetX = this.offsetX;\n    const oldOffsetY = this.offsetY;\n    const oldScale = this.zoomLevel;\n    const newScale = newZoomLevel;\n\n    if (!originalHeight || !originalWidth) return;\n\n    let offsetY = calcNewScaledOffsetForZoomCentering(\n      oldOffsetY,\n      originalHeight,\n      oldScale,\n      newScale,\n      zoomCenter.y\n    );\n    let offsetX = calcNewScaledOffsetForZoomCentering(\n      oldOffsetX,\n      originalWidth,\n      oldScale,\n      newScale,\n      zoomCenter.x\n    );\n\n    const offsetShift =\n      this._calcOffsetShiftSinceLastGestureState(gestureCenterPoint);\n    if (offsetShift) {\n      offsetX += offsetShift.x;\n      offsetY += offsetShift.y;\n    }\n\n    this.offsetX = offsetX;\n    this.offsetY = offsetY;\n    this.zoomLevel = newScale;\n\n    this.panAnim.setValue({ x: this.offsetX, y: this.offsetY });\n    this.zoomAnim.setValue(this.zoomLevel);\n\n    this.props.onZoomAfter?.(\n      e,\n      gestureState,\n      this._getZoomableViewEventObject()\n    );\n  }\n\n  /**\n   * Used to debug pinch events\n   * @param gestureResponderEvent\n   * @param zoomCenter\n   * @param points\n   */\n  _setPinchDebugPoints(\n    gestureResponderEvent: GestureResponderEvent,\n    zoomCenter: Vec2D,\n    ...points: Vec2D[]\n  ) {\n    const { touches } = gestureResponderEvent.nativeEvent;\n    const { originalPageY, originalPageX } = this.state;\n\n    this.setState({\n      debugPoints: [\n        {\n          x: touches[0].pageX - originalPageX,\n          y: touches[0].pageY - originalPageY,\n        },\n        {\n          x: touches[1].pageX - originalPageX,\n          y: touches[1].pageY - originalPageY,\n        },\n        zoomCenter,\n        ...points,\n      ],\n    });\n  }\n\n  /**\n   * Calculates the amount the offset should shift since the last position during panning\n   *\n   * @param {Vec2D} gestureCenterPoint\n   *\n   * @private\n   */\n  _calcOffsetShiftSinceLastGestureState(gestureCenterPoint: Vec2D) {\n    const { movementSensibility } = this.props;\n\n    let shift = null;\n\n    if (this.lastGestureCenterPosition && movementSensibility) {\n      const dx = gestureCenterPoint.x - this.lastGestureCenterPosition.x;\n      const dy = gestureCenterPoint.y - this.lastGestureCenterPosition.y;\n\n      const shiftX = dx / this.zoomLevel / movementSensibility;\n      const shiftY = dy / this.zoomLevel / movementSensibility;\n\n      shift = {\n        x: shiftX,\n        y: shiftY,\n      };\n    }\n\n    this.lastGestureCenterPosition = gestureCenterPoint;\n\n    return shift;\n  }\n\n  /**\n   * Handles movement by tap and move\n   *\n   * @param gestureState\n   *\n   * @private\n   */\n  _handleShifting(gestureState: PanResponderGestureState) {\n    // Skips shifting if panEnabled is false or disablePanOnInitialZoom is true and we're on the initial zoom level\n    if (\n      !this.props.panEnabled ||\n      (this.props.disablePanOnInitialZoom &&\n        this.zoomLevel === this.props.initialZoom)\n    ) {\n      return;\n    }\n    const shift = this._calcOffsetShiftSinceLastGestureState({\n      x: gestureState.moveX,\n      y: gestureState.moveY,\n    });\n    if (!shift) return;\n\n    const offsetX = this.offsetX + shift.x;\n    const offsetY = this.offsetY + shift.y;\n\n    if (\n      this.props.debug &&\n      this.state.originalPageX &&\n      this.state.originalPageY\n    ) {\n      const x = gestureState.moveX - this.state.originalPageX;\n      const y = gestureState.moveY - this.state.originalPageY;\n      this.setState({ debugPoints: [{ x, y }] });\n    }\n\n    this._setNewOffsetPosition(offsetX, offsetY);\n\n    this.raisePin();\n  }\n\n  /**\n   * Set the state to offset moved\n   *\n   * @param {number} newOffsetX\n   * @param {number} newOffsetY\n   * @returns\n   */\n  _setNewOffsetPosition(newOffsetX: number, newOffsetY: number) {\n    const { onShiftingBefore, onShiftingAfter } = this.props;\n\n    if (onShiftingBefore?.(null, null, this._getZoomableViewEventObject())) {\n      return;\n    }\n\n    this.offsetX = newOffsetX;\n    this.offsetY = newOffsetY;\n\n    this.panAnim.setValue({ x: this.offsetX, y: this.offsetY });\n    this.zoomAnim.setValue(this.zoomLevel);\n\n    onShiftingAfter?.(null, null, this._getZoomableViewEventObject());\n  }\n\n  /**\n   * Check whether the press event is double tap\n   * or single tap and handle the event accordingly\n   *\n   * @param e\n   *\n   * @private\n   */\n  private _resolveAndHandleTap = (e: GestureResponderEvent) => {\n    const now = Date.now();\n    if (\n      this.doubleTapFirstTapReleaseTimestamp &&\n      this.props.doubleTapDelay &&\n      now - this.doubleTapFirstTapReleaseTimestamp < this.props.doubleTapDelay\n    ) {\n      this.doubleTapFirstTap &&\n        this._addTouch({\n          ...this.doubleTapFirstTap,\n          id: now.toString(),\n          isSecondTap: true,\n        });\n      this.singleTapTimeoutId && clearTimeout(this.singleTapTimeoutId);\n      delete this.doubleTapFirstTapReleaseTimestamp;\n      delete this.singleTapTimeoutId;\n      delete this.doubleTapFirstTap;\n      this._handleDoubleTap(e);\n    } else {\n      this.doubleTapFirstTapReleaseTimestamp = now;\n      this.doubleTapFirstTap = {\n        id: now.toString(),\n        x: e.nativeEvent.pageX - this.state.originalPageX,\n        y: e.nativeEvent.pageY - this.state.originalPageY,\n      };\n      this._addTouch(this.doubleTapFirstTap);\n\n      // persist event so e.nativeEvent is preserved after a timeout delay\n      e.persist();\n      this.singleTapTimeoutId = setTimeout(() => {\n        delete this.doubleTapFirstTapReleaseTimestamp;\n        delete this.singleTapTimeoutId;\n\n        // Pan to the tapped location\n        if (this.props.staticPinPosition && this.doubleTapFirstTap) {\n          const tapX =\n            this.props.staticPinPosition.x - this.doubleTapFirstTap.x;\n          const tapY =\n            this.props.staticPinPosition.y - this.doubleTapFirstTap.y;\n\n          Animated.timing(this.panAnim, {\n            toValue: {\n              x: this.offsetX + tapX / this.zoomLevel,\n              y: this.offsetY + tapY / this.zoomLevel,\n            },\n            useNativeDriver: true,\n            duration: 200,\n          }).start(() => {\n            this._updateStaticPin();\n          });\n        }\n\n        this.props.onSingleTap?.(e, this._getZoomableViewEventObject());\n      }, this.props.doubleTapDelay);\n    }\n  };\n\n  moveStaticPinTo = (position: Vec2D, duration?: number) => {\n    const { originalWidth, originalHeight } = this.state;\n    const { staticPinPosition, contentWidth, contentHeight } = this.props;\n\n    if (!staticPinPosition) return;\n    if (!originalWidth || !originalHeight) return;\n    if (!contentWidth || !contentHeight) return;\n\n    // Offset for the static pin\n    const pinX = staticPinPosition.x - originalWidth / 2;\n    const pinY = staticPinPosition.y - originalHeight / 2;\n\n    this.offsetX = contentWidth / 2 - position.x + pinX / this.zoomLevel;\n    this.offsetY = contentHeight / 2 - position.y + pinY / this.zoomLevel;\n\n    if (duration) {\n      Animated.timing(this.panAnim, {\n        toValue: { x: this.offsetX, y: this.offsetY },\n        useNativeDriver: true,\n        duration,\n      }).start();\n    } else {\n      this.panAnim.setValue({ x: this.offsetX, y: this.offsetY });\n    }\n  };\n\n  private _staticPinPosition = () => {\n    if (!this.props.staticPinPosition) return;\n    if (!this.props.contentWidth || !this.props.contentHeight) return;\n\n    return viewportPositionToImagePosition({\n      viewportPosition: {\n        x: this.props.staticPinPosition.x,\n        y: this.props.staticPinPosition.y,\n      },\n      imageSize: {\n        height: this.props.contentHeight,\n        width: this.props.contentWidth,\n      },\n      zoomableEvent: {\n        ...this._getZoomableViewEventObject(),\n        offsetX: this.offsetX,\n        offsetY: this.offsetY,\n        zoomLevel: this.zoomLevel,\n      },\n    });\n  };\n\n  private _updateStaticPin = () => {\n    const position = this._staticPinPosition();\n    if (!position) return;\n    this.props.onStaticPinPositionChange?.(position);\n  };\n\n  private _addTouch(touch: TouchPoint) {\n    this.touches.push(touch);\n    this.setState({ touches: [...this.touches] });\n  }\n\n  private _removeTouch(touch: TouchPoint) {\n    this.touches.splice(this.touches.indexOf(touch), 1);\n    this.setState({ touches: [...this.touches] });\n  }\n\n  /**\n   * Handles the double tap event\n   *\n   * @param e\n   *\n   * @private\n   */\n  _handleDoubleTap(e: GestureResponderEvent) {\n    const { onDoubleTapBefore, onDoubleTapAfter, doubleTapZoomToCenter } =\n      this.props;\n\n    onDoubleTapBefore?.(e, this._getZoomableViewEventObject());\n\n    const nextZoomStep = this._getNextZoomStep();\n    if (nextZoomStep == null) return;\n\n    const { originalPageX, originalPageY } = this.state;\n\n    // define new zoom position coordinates\n    const zoomPositionCoordinates = {\n      x: e.nativeEvent.pageX - originalPageX,\n      y: e.nativeEvent.pageY - originalPageY,\n    };\n\n    // if doubleTapZoomToCenter enabled -> always zoom to center instead\n    if (doubleTapZoomToCenter) {\n      zoomPositionCoordinates.x = 0;\n      zoomPositionCoordinates.y = 0;\n    }\n\n    this.zoomTo(nextZoomStep, zoomPositionCoordinates);\n\n    onDoubleTapAfter?.(\n      e,\n      this._getZoomableViewEventObject({ zoomLevel: nextZoomStep })\n    );\n  }\n\n  /**\n   * Returns the next zoom step based on current step and zoomStep property.\n   * If we are zoomed all the way in -> return to initialzoom\n   *\n   * @returns {*}\n   */\n  _getNextZoomStep() {\n    const { zoomStep, maxZoom, initialZoom } = this.props;\n    const { zoomLevel } = this;\n\n    if (maxZoom == null) return;\n\n    if (zoomLevel.toFixed(2) === maxZoom.toFixed(2)) {\n      return initialZoom;\n    }\n\n    if (zoomStep == null) return;\n\n    const nextZoomStep = zoomLevel * (1 + zoomStep);\n    if (nextZoomStep > maxZoom) {\n      return maxZoom;\n    }\n\n    return nextZoomStep;\n  }\n\n  /**\n   * Zooms to a specific level. A \"zoom center\" can be provided, which specifies\n   * the point that will remain in the same position on the screen after the zoom.\n   * The coordinates of the zoom center is relative to the zoom subject.\n   * { x: 0, y: 0 } is the very center of the zoom subject.\n   *\n   * @param newZoomLevel\n   * @param zoomCenter - If not supplied, the container's center is the zoom center\n   */\n  zoomTo(newZoomLevel: number, zoomCenter?: Vec2D) {\n    if (!this.props.zoomEnabled) return false;\n    if (this.props.maxZoom && newZoomLevel > this.props.maxZoom) return false;\n    if (this.props.minZoom && newZoomLevel < this.props.minZoom) return false;\n\n    this.props.onZoomBefore?.(null, null, this._getZoomableViewEventObject());\n\n    // == Perform Pan Animation to preserve the zoom center while zooming ==\n    let listenerId = '';\n    if (zoomCenter) {\n      // Calculates panAnim values based on changes in zoomAnim.\n      let prevScale = this.zoomLevel;\n      // Since zoomAnim is calculated in native driver,\n      //  it will jitter panAnim once in a while,\n      //  because here panAnim is being calculated in js.\n      // However the jittering should mostly occur in simulator.\n      listenerId = this.zoomAnim.addListener(({ value: newScale }) => {\n        this.panAnim.setValue({\n          x: calcNewScaledOffsetForZoomCentering(\n            this.offsetX,\n            this.state.originalWidth,\n            prevScale,\n            newScale,\n            zoomCenter.x\n          ),\n          y: calcNewScaledOffsetForZoomCentering(\n            this.offsetY,\n            this.state.originalHeight,\n            prevScale,\n            newScale,\n            zoomCenter.y\n          ),\n        });\n        prevScale = newScale;\n      });\n    }\n\n    // == Perform Zoom Animation ==\n    getZoomToAnimation(this.zoomAnim, newZoomLevel).start(() => {\n      this.zoomAnim.removeListener(listenerId);\n    });\n    // == Zoom Animation Ends ==\n\n    this.props.onZoomAfter?.(null, null, this._getZoomableViewEventObject());\n    return true;\n  }\n\n  /**\n   * Zooms in or out by a specified change level\n   * Use a positive number for `zoomLevelChange` to zoom in\n   * Use a negative number for `zoomLevelChange` to zoom out\n   *\n   * Returns a promise if everything was updated and a boolean, whether it could be updated or if it exceeded the min/max zoom limits.\n   *\n   * @param {number | null} zoomLevelChange\n   *\n   * @return {bool}\n   */\n  zoomBy(zoomLevelChange: number) {\n    // if no zoom level Change given -> just use zoom step\n    zoomLevelChange ||= this.props.zoomStep || 0;\n    return this.zoomTo(this.zoomLevel + zoomLevelChange);\n  }\n\n  /**\n   * Moves the zoomed view to a specified position\n   * Returns a promise when finished\n   *\n   * @param {number} newOffsetX the new position we want to move it to (x-axis)\n   * @param {number} newOffsetY the new position we want to move it to (y-axis)\n   *\n   * @return {bool}\n   */\n  moveTo(newOffsetX: number, newOffsetY: number) {\n    const { originalWidth, originalHeight } = this.state;\n    if (!originalWidth || !originalHeight) return;\n\n    const offsetX = (newOffsetX - originalWidth / 2) / this.zoomLevel;\n    const offsetY = (newOffsetY - originalHeight / 2) / this.zoomLevel;\n\n    this._setNewOffsetPosition(-offsetX, -offsetY);\n  }\n\n  /**\n   * Moves the zoomed view by a certain amount.\n   *\n   * Returns a promise when finished\n   *\n   * @param {number} offsetChangeX the amount we want to move the offset by (x-axis)\n   * @param {number} offsetChangeY the amount we want to move the offset by (y-axis)\n   *\n   * @return {bool}\n   */\n  moveBy(offsetChangeX: number, offsetChangeY: number) {\n    const offsetX =\n      (this.offsetX * this.zoomLevel - offsetChangeX) / this.zoomLevel;\n    const offsetY =\n      (this.offsetY * this.zoomLevel - offsetChangeY) / this.zoomLevel;\n\n    this._setNewOffsetPosition(offsetX, offsetY);\n  }\n\n  render() {\n    const {\n      staticPinIcon,\n      children,\n      visualTouchFeedbackEnabled,\n      doubleTapDelay,\n      staticPinPosition,\n      onStaticPinLongPress,\n      onStaticPinPress,\n      pinProps,\n    } = this.props;\n\n    const { pinSize, touches, debugPoints = [] } = this.state;\n\n    return (\n      <View\n        style={styles.container}\n        {...this.gestureHandlers.panHandlers}\n        ref={this.zoomSubjectWrapperRef}\n        onLayout={this.measureZoomSubject}\n      >\n        <Animated.View\n          style={[\n            styles.zoomSubject,\n            this.props.style,\n            {\n              transform: [\n                { scale: this.zoomAnim },\n                ...this.panAnim.getTranslateTransform(),\n              ],\n            },\n          ]}\n        >\n          {children}\n        </Animated.View>\n\n        {visualTouchFeedbackEnabled &&\n          touches?.map(\n            (touch) =>\n              doubleTapDelay && (\n                <AnimatedTouchFeedback\n                  x={touch.x}\n                  y={touch.y}\n                  key={touch.id}\n                  animationDuration={doubleTapDelay}\n                  onAnimationDone={() => {\n                    this._removeTouch(touch);\n                  }}\n                />\n              )\n          )}\n\n        {/* For Debugging Only */}\n        {debugPoints.map(({ x, y }, index) => {\n          return <DebugTouchPoint key={index} x={x} y={y} />;\n        })}\n\n        {staticPinPosition && (\n          <StaticPin\n            staticPinIcon={staticPinIcon}\n            staticPinPosition={staticPinPosition}\n            pinSize={pinSize}\n            onPress={onStaticPinPress}\n            onLongPress={onStaticPinLongPress}\n            onParentMove={this._handlePanResponderMove}\n            pinAnim={this.pinAnim}\n            setPinSize={(size: Size2D) => {\n              this.setState({ pinSize: size });\n            }}\n            pinProps={pinProps}\n          />\n        )}\n      </View>\n    );\n  }\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    alignItems: 'center',\n    flex: 1,\n    justifyContent: 'center',\n    overflow: 'hidden',\n    position: 'relative',\n  },\n  zoomSubject: {\n    alignItems: 'center',\n    flex: 1,\n    justifyContent: 'center',\n    width: '100%',\n  },\n});\n\nexport default ReactNativeZoomableView;\n\nexport { ReactNativeZoomableView };\n"]}